<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="com.bms.common.dao.DaoCmd">

    <practitioner_page type="hql" desc="从业人员分页查询">
        <![CDATA[
            from Practitioner p
            where deleted = 0
            <#if name?? && name!=''>
                and p.name like '%'||:name||'%'
            </#if>
            <#if gender?? && gender!=''>
                and p.gender like '%'||:gender||'%'
            </#if>
            <#if organization?? && organization.name!=''>
                and p.organization.name like '%${organization.name}%'
            </#if>
            <#if certNo?? && certNo!=''>
                and p.certNo like '%'||:certNo||'%'
            </#if>
            <#if idNumber?? && idNumber!=''>
                and p.idNumber like '%'||:idNumber||'%'
            </#if>
            <#if status??>
                and p.status = :status
            </#if>
            order by p.createDate desc
        ]]>
    </practitioner_page>

    <vehicle_page type="hql" desc="公交车辆管理-分页查询">
        <![CDATA[
            from Vehicle o
            where o.deleted = 0
            <#if licNo?? && licNo!=''>
                and o.licNo like '%'||:licNo||'%'
            </#if>
            <#if fuelType??>
                and o.fuelType = :fuelType
            </#if>
            <#if vin??&& vin!=''>
                and o.vin = :vin
            </#if>
            <#if cardTime??>
                and o.cardTime = :cardTime
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
            order by o.createDate desc
        ]]>
    </vehicle_page>

    <bus_route_page type="hql" desc="公交线路管理-分页查询">
        <![CDATA[
            from BusRoute o
            where o.deleted = 0
            <#if name?? && name!=''>
                and o.name like '%'||:name||'%'
            </#if>
            <#if waySites?? && waySites!=''>
                and o.waySites like '%'||:waySites||'%'
            </#if>
            <#if mileage?? && mileage!=''>
                and o.mileage like '%'||:mileage||'%'
            </#if>
            <#if organization?? && organization.name!=''>
                and o.organization.name like  '%${organization.name}%'
            </#if>
            <#if price??>
                and o.price = :price
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
            order by o.createDate desc
        ]]>
    </bus_route_page>

    <bus_terminal_page type="hql" desc="公交场站分页查询">
        <![CDATA[
            from BusTerminal b
            where deleted = 0
            <#if name?? && name!=''>
                and b.name like '%'||:name||'%'
            </#if>
            <#if code?? && code!=''>
                and b.code like '%'||:code||'%'
            </#if>
            <#if type??>
                and b.type = :type
            </#if>
            <#if status??>
                and b.status = :status
            </#if>
            order by b.createDate desc
        ]]>
    </bus_terminal_page>

    <bus_car_team_page type="hql" desc="公交车队管理-分页查询">
        <![CDATA[
            from BusTeam o
            where 1=1
            <#if name?? && name!=''>
                and o.name like '%'||:name||'%'
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
            order by o.createDate desc
        ]]>
    </bus_car_team_page>

    <bus_site_page type="hql" desc="公交站点管理-分页查询">
        <![CDATA[
            from BusSite b
            where deleted = 0
            <#if name?? && name!=''>
                and b.name like '%'||:name||'%'
            </#if>
            <#if code?? && code!=''>
                and b.code like '%'||:code||'%'
            </#if>
            <#if province?? && province!=''>
                and b.province = :province
            </#if>
            <#if city?? && city!=''>
                and b.city = :city
            </#if>
            <#if county?? && county!=''>
                and b.county = :county
            </#if>
            <#if status??>
                and b.status = :status
            </#if>
            order by b.createDate desc
        ]]>
    </bus_site_page>

    <notice_page type="hql" desc="行政管理-分页查询">
        <![CDATA[
            from Notice n
            where deleted = 0
            <#if title?? && title!=''>
                and n.title like '%'||:title||'%'
            </#if>
            <#if type??>
                and n.type = :type
            </#if>
           <#if begin?? && end??>
                and n.createDate between :begin and :end
            </#if>
            order by n.createDate desc
        ]]>
    </notice_page>

    <suggest_page type="hql" desc="行政管理-分页查询">
        <![CDATA[
            from Suggest s
            where deleted = 0
            <#if type??>
                and s.type = :type
            </#if>
            <#if status??>
                and s.status = :status
            </#if>
            <#if content?? && content!=''>
                and s.content like '%'||:content||'%'
            </#if>
           <#if begin?? && end??>
                and s.time between :begin and :end
            </#if>
            order by s.createDate desc
        ]]>
    </suggest_page>
    <bus_violation_page type="hql" desc="违规信息管理-分页查询">
        <![CDATA[
            from BusViolation o
            where o.deleted = 0
            <#if vehicle?? && vehicle.licNo!=''>
                and o.vehicle.licNo like '%${vehicle.licNo}%'
            </#if>
            <#if practitioner?? && practitioner.name!=''>
                and o.practitioner.name like '%${practitioner.name}%'
            </#if>
            <#if busRoute?? && busRoute.name!=''>
                and o.busRoute.name like '%${busRoute.name}%'
            </#if>
            <#if vehType?? && vehType!=''>
                and o.vehType like '%'||:vehType||'%'
            </#if>
            <#if organization?? && organization.name!=''>
                and o.organization.name like  '%${organization.name}%'
            </#if>
            <#if type??>
                and o.type = :type
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
           <#if begin?? && end??>
                and o.time between :begin and :end
            </#if>
            order by o.createDate desc
        ]]>
    </bus_violation_page>
    <bus_violation_stats_type type="sql" desc="事件统计分析-违规类型">
        <![CDATA[
             select v.type as type, d.text as text, count(*) as num
            from bus_violations v
            left join
                (select text,value,`index` from sys_dict where code = 'VIOLATION_TYPE_CHILD') d
            on d.value = v.type
            where v.is_delete = 0
             <#if begin?? && end??>
                and v.time between :begin and :end
            </#if>
            group by type
            order by d.index asc
        ]]>
    </bus_violation_stats_type>

    <bus_violation_stats_company type="sql" desc="事件统计分析-公司违规排行">
        <![CDATA[
            select
                o.name as company,
                count(*) as num
            from
                bus_violations v
            left join
                organizations o on o.id = v.org_id
            where
                v.is_delete = 0
            <#if begin?? && end??>
                and v.time between :begin and :end
            </#if>
            group by v.org_id
            order by num desc
        ]]>
    </bus_violation_stats_company>

    <bus_violation_stats_driver type="sql" desc="事件统计分析-司机违规排行">
        <![CDATA[
            select
                p.name as driver,
                o.name as company,
                count(*) as num
            from
                bus_violations v
            left join
                practitioners p on p.id = v.pract_id
            left join
                organizations o on o.id = v.org_id
            where
                v.is_delete = 0
            <#if begin?? && end??>
                and v.time between :begin and :end
            </#if>
            group by v.pract_id
            order by num desc
        ]]>
    </bus_violation_stats_driver>

    <bus_violation_stats_week type="sql" desc="事件统计分析-全部违规行为统计(周、月、年)-周">
        <![CDATA[
            select v.type, d.text, count(*) as num
            from bus_violations v
            left join
                (select text,value,`index` from sys_dict where code = 'VIOLATION_TYPE_CHILD') d
            on d.value = v.type
            where v.is_delete = 0
            <#if begin?? && end??>
                and v.time between :begin and :end
            </#if>
            group by v.type
            order by d.index asc
        ]]>
    </bus_violation_stats_week>

    <bus_online_data_declare_stats type="sql" desc="燃油消耗管理-统计数据表">
        <![CDATA[
            SELECT
                sum(gas_quantity) as gas_quantity,
                sum(diesel_oil_quantity) as diesel_oil_quantity,
                sum(natural_gas_quantity) as natural_gas_quantity,
                sum(electric_quantity) as electric_quantity
            FROM bus_online_data_declare_items
            where is_delete = 0
            <#if begin?? && end??>
                and create_date between :begin and :end
            </#if>
            <#if organization?? && organization.id!=''>
                and org_id = ${organization.id}
            </#if>
            <#if busRoute?? && busRoute.id!=''>
                and route_id= ${busRoute.id}
            </#if>
        ]]>
    </bus_online_data_declare_stats>

    <online_data_declare_page type="hql" desc="网上申报管理-分页查询">
        <![CDATA[
            from BusOnlineDataDeclare b
            where b.deleted = 0
            <#if organization?? && organization.name!=''>
                and b.organization.name like '%${organization.name}%'
            </#if>
            <#if status??>
                and b.status = :status
            </#if>
            <#if begin??>
                and b.startTime &gt;= :begin
            </#if>
            <#if end??>
                and b.startTime &lt;= :end
            </#if>
            order by b.createDate desc
        ]]>
    </online_data_declare_page>

    <bus_online_data_declare_retrieval type="sql" desc="查询统计分析">
        <![CDATA[
            select
                org_name,
                team_name,
                route_name,
                gas_quantity,
                gas_price,
                gas_balance,
                diesel_oil_quantity,
                diesel_oil_price,
                diesel_oil_balance,
                natural_gas_quantity,
                natural_gas_price,
                natural_gas_balance,
                electric_quantity,
                electric_price,
                electric_balance,
                sum(gas_balance+diesel_oil_balance+natural_gas_balance+electric_balance) as total_balance
            from bus_online_data_declare_items b
            where is_delete =0
            group by b.org_id,b.team_id,b.route_id,b.veh_code
            order by total_balance desc
        ]]>
    </bus_online_data_declare_retrieval>
    <bus_online_data_declare_total type="sql" desc="查询统计总计">
        <![CDATA[
            select
                sum(gas_quantity),
                sum(gas_balance),
                sum(diesel_oil_quantity),
                sum(diesel_oil_balance),
                sum(natural_gas_quantity),
                sum(natural_gas_balance),
                sum(electric_quantity),
                sum(electric_balance)
            from bus_online_data_declare_items b
            where is_delete =0
            <#if organization?? && organization.name!=''>
                and b.organization.name like '%${organization.name}%'
            </#if>
            <#if organization?? && organization.name!=''>
                and b.organization.name like '%${organization.name}%'
            </#if>
            <#if carTeam?? && carTeam.id!=''>
                and b.carTeam.id = :carTeam.id
            </#if>
            <#if busRoute?? && busRoute.id!=''>
                and b.busRoute.id = :busRoute.id
            </#if>
            <#if vehCode?? && vehCode!=''>
                and b.vehCode like '%'||:vehCode||'%'
            </#if>
        ]]>
    </bus_online_data_declare_total>

</mapper>