<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="com.bms.common.dao.DaoCmd">
    <organization_page type="hql">
        <![CDATA[
            from Organization o
            where 1=1
            <#if name?? && name!=''>
                and o.name like :name
            </#if>
            <#if level!=0>
                and o.level = :level
            </#if>
            and o.deleted=:deleted order by o.createDate desc
        ]]>
    </organization_page>

    <role_page type="hql">
        <![CDATA[
            from Role r
            where deleted = 0
            <#if name?? && name!=''>
                and r.name like :name
            </#if>
            <#if remark?? && remark!=''>
                and r.remark like :remark
            </#if>
            order by r.createDate desc
        ]]>
    </role_page>

    <user_page type="hql">
        <![CDATA[
            from User u
            where deleted = 0
            <#if keyword?? && keyword!=''>
                and (u.account like :keyword or u.realName like :keyword)
            </#if>
            order by u.createDate desc
        ]]>
    </user_page>

    <menu_findPermissionCodeByUserId type="sql" desc="查找用户拥有的权限编码">
        <![CDATA[
            SELECT distinct permission_code FROM menus m
            inner join role_menus rm on rm.menu_id  = m.id
            inner join roles r on r.id = rm.role_id
            inner join users u on r.id = u.role_id
            where u.id = :userId and m.type =2
        ]]>
    </menu_findPermissionCodeByUserId>
</mapper>