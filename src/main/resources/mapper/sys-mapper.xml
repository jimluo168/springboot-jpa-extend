<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="com.bms.common.dao.DaoCmd">
    <organization_page type="hql">
        <![CDATA[
            from Organization o
            where o.deleted = 0
            <#if name?? && name!=''>
                and o.name like :name||'%'
            </#if>
            <#if level??>
                and o.level = :level
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
            order by o.createDate desc
        ]]>
    </organization_page>

    <role_page type="hql">
        <![CDATA[
            from Role r
            where deleted = 0
            <#if name?? && name!=''>
                and r.name like :name||'%'
            </#if>
            <#if remark?? && remark!=''>
                and r.remark like :remark||'%'
            </#if>
            order by r.createDate desc
        ]]>
    </role_page>

    <user_page type="hql">
        <![CDATA[
            from User u
            where deleted = 0
            <#if account?? && account!=''>
                and u.account like :account
            </#if>
            <#if realName?? && realName!=''>
                and u.realName like :realName||'%'
            </#if>
            <#if organization?? && organization!=''>
                and u.organization.name like :organization||'%'
            </#if>
            <#if status!= -1>
                and u.status = :status
            </#if>
            order by u.createDate desc
        ]]>
    </user_page>

    <menu_findPermissionCodeByUserId type="sql" desc="查找用户拥有的权限编码">
        <![CDATA[
            SELECT distinct permission_code FROM menus m
            inner join role_menus rm on rm.menu_id  = m.id
            inner join roles r on r.id = rm.role_id
            inner join users u on r.id = u.role_id
            where u.id = :userId and m.type =2
        ]]>
    </menu_findPermissionCodeByUserId>

    <oplog_page type="hql" desc="操作日志 分页查询">
        <![CDATA[
            from OperationLog o
            where 1=1
            <#if account?? && account!=''>
                and o.account = :account
            </#if>
            <#if realName?? && realName!=''>
                and o.realName like :realName||'%'
            </#if>
            <#if orgName?? && orgName!=''>
                and o.orgName like :orgName||'%'
            </#if>
            <#if module?? && module!=''>
                and o.module like :module
            </#if>
            <#if funcName?? && funcName!=''>
                and o.funcName like :funcName
            </#if>
            <#if params?? && params!=''>
                and o.params like :params||'%'
            </#if>
            <#if ip?? && ip!=''>
                and o.ip like :ip
            </#if>
            <#if begin?? && end??>
                and o.createDate between :begin and :end
            </#if>
            order by o.createDate desc
        ]]>
    </oplog_page>

    <dict_page type="hql" desc="字典分页查询">
        <![CDATA[
            from Dictionary o
            where o.deleted = 0
            <#if code?? && code!=''>
                and o.code = :code
            </#if>
            order by o.createDate desc
        ]]>
    </dict_page>

    <practitioner_page type="hql" desc="从业人员分页查询">
        <![CDATA[
            from Practitioner p
            where deleted = 0
            <#if name?? && name!=''>
                and p.name like :name
            </#if>
            <#if gender?? && gender!=''>
                and p.gender like :gender||'%'
            </#if>
            <#if organization?? && organization!=''>
                and p.organization.name like :organization||'%'
            </#if>
            <#if certNo?? && certNo!=''>
                and p.certNo like :certNo||'%'
            </#if>
            <#if idNumber?? && idNumber!=''>
                and p.idNumber like :idNumber||'%'
            </#if>
            order by p.createDate desc
        ]]>
    </practitioner_page>

    <vehicle_page type="hql" desc="公交车辆管理-分页查询">
        <![CDATA[
            from Vehicle o
            where o.deleted = 0
            <#if lic_no?? && lic_no!=''>
                and o.licNo like :licNo||'%'
            </#if>
            <#if fuel_type??>
                and o.fuelType = :fuelType
            </#if>
            <#if vin??&& vin!=''>
                and o.vin = :vin
            </#if>
            <#if card_time??>
                and o.cardTime = :cardTime
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
            order by o.createDate desc
        ]]>
    </vehicle_page>

    <bus_route_page type="hql" desc="公交线路管理-分页查询">
        <![CDATA[
            from BusRoute o
            where o.deleted = 0
            <#if name?? && name!=''>
                and o.name like :name||'%'
            </#if>
            <#if waySites?? && waySites!=''>
                and o.waySites like :waySites||'%'
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
            order by o.createDate desc
        ]]>
    </bus_route_page>

    <bus_terminal_page type="hql" desc="公交场站分页查询">
        <![CDATA[
            from BusTerminal b
            where deleted = 0
            <#if name?? && name!=''>
                and b.name like :name
            </#if>
            <#if code?? && code!=''>
                and b.code like :code||'%'
            </#if>
            <#if type?? && type!=''>
                and b.type like :type||'%'
            </#if>
            <#if status??>
                and b.status = :status
            </#if>
            order by b.createDate desc
        ]]>
    </bus_terminal_page>

    <bus_car_team_page type="hql" desc="公交车队管理-分页查询">
        <![CDATA[
            from BusTeam o
            where 1=1
            <#if name?? && name!=''>
                and o.name like :name||'%'
            </#if>
            <#if status??>
                and o.status = :status
            </#if>
            order by o.createDate desc
        ]]>
    </bus_car_team_page>

    <bus_site_page type="hql" desc="公交站点管理-分页查询">
        <![CDATA[
            from BusSite b
            where deleted = 0
            <#if name?? && name!=''>
                and b.name like :name||'%'
            </#if>
            <#if code?? && code!=''>
                and b.code like :code||'%'
            </#if>
            <#if province?? && province!=''>
                and b.province like :province||'%'
            </#if>
            <#if city?? && code!=''>
                and b.city like :city||'%'
            </#if>
            <#if county?? && county!=''>
                and b.county like :county||'%'
            </#if>
            <#if status??>
                and b.status = :status
            </#if>
            order by b.createDate desc
        ]]>
    </bus_site_page>
</mapper>